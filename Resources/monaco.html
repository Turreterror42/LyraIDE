<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Monaco Editor in Qt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs/loader.js"></script>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <style>
        html, body, #editor {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="editor"></div>

    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs' } });

        require(['vs/editor/editor.main'], function () {
            window.editor = monaco.editor.create(document.getElementById('editor'), {
                value: "",
                language: "plaintext",
                minimap: { enabled: false }
            });

            window.addEventListener('resize', () => {
                const rect = document.getElementById('editor').getBoundingClientRect();
                window.editor.layout({ width: rect.width, height: rect.height });
            });

            // Wait for the QWebChannel to initialize
            new QWebChannel(qt.webChannelTransport, function (channel) {
                window.bridge = channel.objects.bridge;

                // These methods are now accessible via bridge.callXYZ from C++ using runJavaScript()
                window.setEditorText = function (text) {
                    if (window.editor) {
                        window.editor.setValue(text);
                    }
                };

                window.setEditorTheme = function (theme) {
                    monaco.editor.setTheme(theme);
                };

                window.setEditorLanguage = function (lang) {
                    if (window.editor && window.editor.getModel()) {
                        monaco.editor.setModelLanguage(window.editor.getModel(), lang);
                    }
                };

                window.getEditorText = function () {
                    return window.editor ? window.editor.getValue() : "";
                };

                window.setEditorReadOnly = function (readonly) {
                    if (window.editor) {
                        window.editor.updateOptions({ readOnly: readonly });
                    }
                };
            });
        });
    </script>
</body>
</html>
